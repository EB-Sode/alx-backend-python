#!/bin/bash

# kubctl-0x02
# Blue-Green Deployment Automation for Messaging App

set -e  # Exit on any error

echo "ğŸŸ¦ Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸŸ© Deploying GREEN version..."
kubectl apply -f messaging_app/green_deployment.yaml

echo "ğŸ§± Ensuring service exists..."
kubectl apply -f kubeservice.yaml

echo "ğŸ” Checking pod status..."
kubectl get pods -l app=messaging-app

echo "ğŸ“œ Fetching GREEN deployment logs..."
GREEN_POD=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs "$GREEN_POD"

echo "âœ… If green logs show no errors, switch traffic with:"
echo "kubectl patch service messaging-app-service -p '{\"spec\":{\"selector\":{\"app\":\"messaging-app\",\"version\":\"green\"}}}'"

echo "ğŸ” To rollback to BLUE:"
echo "kubectl patch service messaging-app-service -p '{\"spec\":{\"selector\":{\"app\":\"messaging-app\",\"version\":\"blue\"}}}'"

echo "ğŸ‰ Blue-Green deployment process complete!"
